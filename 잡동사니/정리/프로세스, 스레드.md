# 프로세스, 스레드

## 프로세스의 개념

### 프로세스란

- 실행중인 프로그램으로 운영체제에서 프로그램을 실행하는 작업 단위
- CPU점유, 메모리, 파일, I/O devices가 필요

### 프로세스의 구조

![image-20250121105718936](C:\Users\admin1\AppData\Roaming\Typora\typora-user-images\image-20250121105718936.png)

- text: 실행 가능한 코드를저장한 공간
- Data : 전역 변수를 저장한 공간
- Heap: 프로그램 실행동안 동적으로 할당되는변수가 저장되는 공간
- Stack: 함수가 실행되는 동안 지역변수가 저장되는 임시공간(함수 영역)  

### 프로세스의상태

 ![image-20250121105944872](C:\Users\admin1\AppData\Roaming\Typora\typora-user-images\image-20250121105944872.png)

- New: 생성
- Running: 수행
- Waiting: 이벤트가 발생되어 입/출력 완료 대기
- Ready: 실행되기를 기다리는 상태(항시 실행 가능)
- Terminated: 실행 종료

항상 떠있는 프로그램은 데몬이라고 부름

### 프로세스 제어 블록(Process Control Block, PCB)

- 각각의 프로세스는 PCB로 표현

![image-20250121110126053](C:\Users\admin1\AppData\Roaming\Typora\typora-user-images\image-20250121110126053.png)

- Program Counter
  - CPU가 다음에 실행할 명령어의 주소를 저장하는 레지스터
  - Context Switching(문맥 교환)시 프로세스가 실행되던 위치 추적
- CPU registers: Instruction Register(IR), Data Register(DR), Program Counter(PC)와 같은 저장 공간 포함
- CPU 스케줄링 정보
- 메모리 관리 정보
- 통계 정보
- 입/출력 상태 정보
- list of open files
  - 프로세스가 현재 열고 있는 모든 파일들의 목록
  - 파일접근관리, 자원해제(프로세스 종료시 파일 닫기), 파일 공유 및 동기화(여러 프로세스에서 같은 파일 open시 데이터 일관성 유지), 권한 관리(읽기, 쓰기 실행) 등의 관리를 위해 PCB에 필요

### 프로세스와 쓰레드

- 프로세스
  - 한개 이상의 쓰레드를 포함하는 실행중인 프로그램
  - 각 프로세스간 독립된 자원 할당
- 쓰레드
  - 프로세스 안에 또다른 작은 프로세스 의미
  - CPU가 프로세스를 실행시키기 위한 최소 작업 단위
  - 한 프로세스 안에 포함된 쓰레드들은 프로세스의 자원 공유



## 프로세스의 스케줄링

### 멀티프로그래밍과 시분할의 목적

- 멀티프로그래밍의 목적
  - 동시에 여러 프로세스를 실행하여 CPU 효율 극대화
- 시분할 시스템(Time Sharing System)의 목적
  - CPU Core가 여러 프로세스를 변경하며 사용자가 프로그램들이 동시에 수행되는 것처럼 보이게

### 스케줄링 큐

- 프로세스들이 Ready 상태, CPU Core 위에서 실행하기 위해 기다릴 때 프로세스는 Ready Queue에 삽입.
- 특정 이벤트 발생되기 기다리는 프로세스는Wait Queue로
- 이 때 큐들은 PCB들의 Linked list로 구현
  - Linked list는 각 요소가 뒤의 값만 기억하고 있으면 되서 삽입, 삭제가 용이 

### 문맥 교환

- 프로세스에서 문맥이란 마지막에 수행했던 명령어 위치
- 문맥은 PCB에 표시
- 인터럽트 발생 시 운영체제는 현재 수행중인 프로세스의 문맥을 저장, 후에 수행시 저장됐던 문맥 복구
- Context Switch
  - CPU Core를 다른 프로세스에게 양도
  - 현재 프로세스 상태 저장
  - Context Switch하면 다른 Process Context 복원

![image-20250121111544282](C:\Users\admin1\AppData\Roaming\Typora\typora-user-images\image-20250121111544282.png)





# 프로세스 간 통신

### 프로세스간 통신

- 프로세스간 독립적 or 상호협력적으로 통신하며 동시에 실행
- 독립적 = 데이터 공유 X, 상호협력적 = 데이터 공유 가능 & 타 프로세스들에 영향 가능



### IPC(Integer-Process Communication)

- 프로세스간 통신하는 방법
- 주요 모델
  - 공유 메모리(Shared memory)
  - 메시지 송수신(message Passing)

![image-20250121112140375](C:\Users\admin1\AppData\Roaming\Typora\typora-user-images\image-20250121112140375.png)

- (a)는 공유 메모리를 사용하는 방법으로, 메모리 위에 프로세스간 데이터를 공유할 수 있는 메모리 영역 사용
- (b)는 메시지 송수신 방법으로 메모리 위에 메시지 큐를 놓고 프로세스들이 전송할 데이터를 메시지 큐에 전송하고 프로세스들이 메시지큐를 통해 데이터를 수신하는 방법 



## 공유 메모리

### 생산자-소비자 문제

- 생산자: 데이터를 생성 및 공유 자원에 추가하는 역할
- 소비자: 공유 자원에 추가된 데이터를 꺼내서 사용하는 역할
- 버퍼: 공유 자원으로 생산자가 만든 데이터를 임시로 보관하는 역할
- 생산자가 데이터를 넣고, 소비자가 데이터를 꺼내는 작업을 동기화하여 충돌, 데이터 손실이 발생하지 않도록 해야함.

- 수행과정
  - 생산자가 데이터 생산하여 버퍼에 넣기
  - 소비자가 버퍼에서 데이터를 꺼내서 사용
  - 생산자는 버퍼가 가득차면 대기
  - 소비자는 버퍼가 비면 대기

## 메시지 전송

### 메시지 전송

- 프로세스간 데이터 전송 및 읽기와 같은 통신을 위한 두번째 방법.
- 메시지 전송을 구현하기 위한 방법으론 메시지큐, 파이프, 소켓, 원격 프로시저 콜(Remote Procedure Call, RPC) 등이 있음
- 운영체제는 메시지 전송 기능을 통해 각각의 프로세스들이 통신하기 위한 API 제공

### 파이프

- 단방향 또는 양방향 채널을 생성하여 2개 이상의 프로세스가 서로 통신할 수 있도록 하는 IPC 기술
- 프로세스간 데이터를 전송할 수 있는 가상 통신 채널로 시스템 콜을 사용해 구현 가능
- 장점
  - 단순함, 효율성, 신뢰성 유연성
- 단점
  - 제한된 용량, 단방향성(단방향 파이프), 동기화, 제한된 확장