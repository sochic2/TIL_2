# Multithreaded Programming

## Thread

- CPU 수행의 기본단위
- 스레드가 수행되는 환경을 Task라고 함. 전통적인 프로세스는 하나의 Thread가 있는 Task와 일치
- 스레드는 Thread ID, Program counter, Register set, Stack space로 구성.
  - Code, Data 섹션이나 운영체제 자원은 스레드끼리 공유
- 멀티스레드는 한 프로세스가 여러 스레드로 동시에 여러 작업을 수행하는 것을 말함.
- 프로세스 내의 스레드는 모두 각각 독립적인 실행 파일
- 멀티프로세스 대신 멀티 스레드 사용하는 이유
  - 프로세스 생성, Context switching 작업이 무겁고 잦으면 성능 저하가 발생하는데, 스레드 생성, switching은 이에 비해 가볍다.
  - 두 프로세스가 하나의 데이터를 공유하려면 메시지 패싱, 공유 메모리 등을 사용해야 하는데 효율이 떨어지고, 구현, 관리가 번거로움.



##  Multithreading

- 프로세서가 여러개인 경우 멀티스레드를 통해 병렬성 향상 가능(여러작업 동시 수행)

- 한 프로세스의 스레드들이 각각 다른 프로세서에서 병렬적으로 수행 가능

- 프로세서가 하나인 경우 동시성 향상 가능

  - 실제론 각각의 시간에 한 작업만 수행되지만 병렬적으로 수행되는 것처럼 보임
  - 한 스레드가 waiting이 되어도 커널이 다른 스레드로 switch시켜 실행해 하나의 프로세서임에도 빠른 처리와 계산속도 향상 가능

- 멀티스레딩의 장점

  - 응답성
    - 싱글 스레드는 작업이 끝나기 전까지 응답 x , 멀티스레드는 작업을 분리해 수행하여 실시간 응답 가능
  - 자원공유
    - 프로세스는 공유 메모리, 메시지 패싱을 통해 자원을 공유하지만 스레드는 자신이 속한 프로세스 내의 스레드들과 메모리, 자원을 공유하여 효율적
  - 경제성
    - 프로세스 생성비용보다 스레드 생성이 경제적
    - Context switching의 오버헤드가 프로세스보다 경제적

  - 확장성
    - 싱글 스레드는 한 프로세스가 한 코어에서만 수행 가능하고, 멀티 스레드는 여러 코어에서 수행할 수 있어 더 효율적

- Python 실험

  - Python의 경우 GIL(Global Interpreter Lock)때문에 하나의 스레드만 작동, 스레드가 다수 생성되어 잇더라도..
  - 하지만, 실행중이던 스레드가 wiaiting상태에 빠지면 다른 스레드가 동작.(ex, I/O작업)
  - 근데 만약 select해온 데이터로 다음 작업을 수행해야한다면 다음 스레드가 이를 받아서 해야하는데, 값이 아직 조회되지 않아 어떻게 될까 궁금했음

  ![image-20250123162144614](C:\Users\admin1\AppData\Roaming\Typora\typora-user-images\image-20250123162144614.png)

  - queue를 통해 해결. get으로 데이터가 들어올때까지 대기하고 잇음. 빈 queue에 get 하면 계속 대기함

![image-20250123164514041](C:\Users\admin1\AppData\Roaming\Typora\typora-user-images\image-20250123164514041.png)

- 임계구역문제 해보려고 counter에 저장한것 했을 때는, GIL때문에 무난하게 0이 찍혀서 파일에 저장된 값에서 -1씩 뺐더니 파일을 읽고있어서 접근이 안되어 897같은 적은 숫자가 빠졌는데, `threading.Lock()`을 써보니 이를 해결해주고 0을 return

## User-level Thread vs Kernel-level Thread

- 유저 스레드는 커널의 지원 없이 스레드라이브러리가 관리. 커널 스레드는 커널이 지원
- 커널 스레드 사용시 안정적이지만,  